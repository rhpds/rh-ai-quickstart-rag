# Ansible Example - GitOps Configuration
# Installs Web Terminal operator, deploys a sample application, and Showroom lab guide

# Job configuration
job:
  name: ansible-demo
  ttlSecondsAfterFinished: 600
  restartPolicy: Never

# Namespace where the ansible-runner job runs
# NOTE: Do NOT use openshift-operators - that namespace is for operators only
namespace:
  name: ansible-runner
  create: true

# Git repository containing your Ansible playbooks
ansible:
  repository:
    # IMPORTANT: Update this to point to YOUR playbook repository
    url: "https://github.com/rhpds/field-sourced-content-template"
    branch: "main"
    # Path within the repo to the playbooks directory
    path: "examples/ansible/playbooks"

  # Main playbook to execute
  playbook: "site.yml"

  # Python packages to install
  requirements:
    - ansible-core
    - ansible-runner
    - kubernetes
    - openshift
    - PyYAML
    - requests

  # Ansible collections (pinned for ansible-core 2.15.x compatibility)
  # Note: agnosticd.showroom is NOT needed - we use a local deploy-showroom role
  collections:
    - kubernetes.core:==3.2.0
    - community.general:==9.5.0
    - community.crypto:==2.22.3

  # Extra variables passed to the playbook
  extraVars:
    operator_name: "web-terminal"
    operator_channel: "fast"
    demo_namespace: "terminal-demo"
    app_name: "hello-world"
    # Showroom configuration - UPDATE THIS to your lab guide repository
    showroom_git_repo: "https://github.com/rhpds/showroom_template_nookbag.git"
    showroom_git_ref: "main"

# Container configuration
image:
  repository: registry.redhat.io/ubi8/python-39
  tag: latest
  pullPolicy: IfNotPresent

# Resource limits and requests
resources:
  requests:
    cpu: "200m"
    memory: "256Mi"
  limits:
    cpu: "1000m"
    memory: "1Gi"

# ServiceAccount configuration
serviceAccount:
  name: ansible-runner
  annotations: {}

# RBAC - permissions for the playbook
rbac:
  create: true
  additionalRules:
    # Required for installing operators
    - apiGroups: ["operators.coreos.com"]
      resources: ["subscriptions", "clusterserviceversions", "installplans"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
    # Required for deploying applications
    - apiGroups: ["apps"]
      resources: ["deployments"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
    # Required for Showroom Helm deployment
    - apiGroups: ["route.openshift.io"]
      resources: ["routes"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

# Sync wave for ArgoCD deployment order
syncWave:
  rbac: "1"
  job: "2"

# Values injected by field content workload
deployer:
  domain: ""
  apiUrl: ""
